<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TEAM - Login</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="login-page">
  <div class="login-box">
    <div class="logo">TEAM</div>
    <div class="login-subtitle">MANAGEMENT SYSTEM</div>
    <div class="login-form">
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Username:</label>
          <input type="text" class="form-input" id="username" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label">Password:</label>
          <input type="password" class="form-input" id="password">
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%" id="loginBtn">Login</button>
      </form>
      <div class="login-error" id="error"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="js/config.js"></script>
  <script src="js/db.js"></script>
  <script>
    DB.init();
    if (DB.isLoggedIn()) {
      location.href = DB.getUser().role === 'admin' ? 'admin.html' : 'assistant.html';
    }

    document.getElementById('loginForm').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      const err = document.getElementById('error');
      err.style.display = 'none';
      btn.disabled = true;
      btn.textContent = 'Loading...';

      const r = await DB.login(
        document.getElementById('username').value.trim(),
        document.getElementById('password').value
      );

      if (r.success) {
        location.href = r.user.role === 'admin' ? 'admin.html' : 'assistant.html';
      } else {
        err.textContent = r.error;
        err.style.display = 'block';
        btn.disabled = false;
        btn.textContent = 'Login';
      }
    };
  </script>
</body>
</html>
